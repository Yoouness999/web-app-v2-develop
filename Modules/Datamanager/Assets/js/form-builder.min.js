(function(){var e;e=function(e,t){var o,n;for(o in e)n=e[o],"$$hashKey"!==o&&(t[o]=n)},angular.module("builder.controller",["builder.provider"]).controller("fbFormObjectEditableController",["$scope","$injector",function(t,o){var n;return n=o.get("$builder"),t.setupScope=function(o){var r;return e(o,t),t.optionsText=o.options.join("\n"),t.$watch("[label, name, description, placeholder, required, options, validation]",function(){return o.label=t.label,o.name=t.name,o.description=t.description,o.placeholder=t.placeholder,o.required=t.required,o.options=t.options,o.validation=t.validation},!0),t.$watch("optionsText",function(e){var o;return t.options=function(){var t,n,r,i;for(r=e.split("\n"),i=[],t=0,n=r.length;n>t;t++)o=r[t],o.length>0&&i.push(o);return i}(),t.inputText=t.options[0]}),r=n.components[o.component],t.validationOptions=r.validationOptions},t.data={model:null,backup:function(){return this.model={label:t.label,name:t.name,description:t.description,placeholder:t.placeholder,required:t.required,optionsText:t.optionsText,validation:t.validation}},rollback:function(){return this.model?(t.label=this.model.label,t.name=this.model.name,t.description=this.model.description,t.placeholder=this.model.placeholder,t.required=this.model.required,t.optionsText=this.model.optionsText,t.validation=this.model.validation):void 0}}}]).controller("fbComponentsController",["$scope","$injector",function(e,t){var o;return o=t.get("$builder"),e.selectGroup=function(t,n){var r,i,l,u;null!=t&&t.preventDefault(),e.activeGroup=n,e.components=[],l=o.components,u=[];for(i in l)r=l[i],r.group===n&&u.push(e.components.push(r));return u},e.groups=o.groups,e.activeGroup=e.groups[0],e.allComponents=o.components,e.$watch("allComponents",function(){return e.selectGroup(null,e.activeGroup)})}]).controller("fbComponentController",["$scope",function(t){return t.copyObjectToScope=function(o){return e(o,t)}}]).controller("fbFormController",["$scope","$injector",function(e,t){var o,n;return o=t.get("$builder"),n=t.get("$timeout"),null==e.input&&(e.input=[]),e.$watch("form",function(){return e.input.length>e.form.length&&e.input.splice(e.form.length),n(function(){return e.$broadcast(o.broadcastChannel.updateInput)})},!0)}]).controller("fbFormObjectController",["$scope","$injector",function(t,o){var n;return n=o.get("$builder"),t.copyObjectToScope=function(o){return e(o,t)},t.updateInput=function(e){var o;return o={id:t.formObject.id,name:t.formObject.name,label:t.formObject.label,value:null!=e?e:""},t.$parent.input.splice(t.$index,1,o)}}])}).call(this),function(){angular.module("builder.directive",["builder.provider","builder.controller","builder.drag","validator"]).directive("fbBuilder",["$injector",function(e){var t,o;return t=e.get("$builder"),o=e.get("$drag"),{restrict:"A",scope:{fbBuilder:"="},template:"<div class='form-horizontal'>\n    <div class='fb-form-object-editable' ng-repeat=\"object in formObjects\"\n        fb-form-object-editable=\"object\"></div>\n</div>",link:function(e,n,r){var i,l,u;return e.formName=r.fbBuilder,null==(l=t.forms)[u=e.formName]&&(l[u]=[]),e.formObjects=t.forms[e.formName],i=!0,$(n).addClass("fb-builder"),o.droppable($(n),{move:function(e){var t,o,r,l,u,a,c,p,d,s,f;if(i&&($("div.fb-form-object-editable").popover("hide"),i=!1),r=$(n).find(".fb-form-object-editable:not(.empty,.dragging)"),0===r.length)return void(0===$(n).find(".fb-form-object-editable.empty").length&&$(n).find(">div:first").append($("<div class='fb-form-object-editable empty'></div>")));for(c=[],c.push(-1e3),u=p=0,s=r.length;s>p;u=p+=1)o=$(r[u]),a=o.offset(),l=o.height(),c.push(a.top+l/2);for(c.push(c[c.length-1]+1e3),u=d=1,f=c.length;f>d;u=d+=1)if(e.pageY>c[u-1]&&e.pageY<=c[u]){$(n).find(".empty").remove(),t=$("<div class='fb-form-object-editable empty'></div>"),u-1<r.length?t.insertBefore($(r[u-1])):t.insertAfter($(r[u-2]));break}},out:function(){return i&&($("div.fb-form-object-editable").popover("hide"),i=!1),$(n).find(".empty").remove()},up:function(l,u,a){var c,p,d;return i=!0,o.isMouseMoved()?(u||"drag"!==a.mode?u&&("mirror"===a.mode&&t.insertFormObject(e.formName,$(n).find(".empty").index(".fb-form-object-editable"),{component:a.object.componentName}),"drag"===a.mode&&(d=a.object.formObject.index,p=$(n).find(".empty").index(".fb-form-object-editable"),p>d&&p--,t.updateFormObjectIndex(e.formName,d,p))):(c=a.object.formObject,c.editable&&t.removeFormObject(r.fbBuilder,c.index)),$(n).find(".empty").remove()):void $(n).find(".empty").remove()}})}}}]).directive("fbFormObjectEditable",["$injector",function(e){var t,o,n,r;return t=e.get("$builder"),n=e.get("$drag"),o=e.get("$compile"),r=e.get("$validator"),{restrict:"A",controller:"fbFormObjectEditableController",scope:{formObject:"=fbFormObjectEditable"},link:function(e,i){var l;return e.inputArray=[],e.$component=t.components[e.formObject.component],e.setupScope(e.formObject),e.$watch("$component.template",function(t){var n;if(t)return n=o(t)(e),$(i).html(n)}),$(i).on("click",function(){return!1}),n.draggable($(i),{object:{formObject:e.formObject}}),e.formObject.editable?(l={},e.$watch("$component.popoverTemplate",function(t){return t?($(i).removeClass(l.id),l={id:"fb-"+Math.random().toString().substr(2),isClickedSave:!1,view:null,html:t},l.html=$(l.html).addClass(l.id),l.view=o(l.html)(e),$(i).addClass(l.id),$(i).popover({html:!0,title:e.$component.label,content:l.view,container:"body"})):void 0}),e.popover={save:function(t){t.preventDefault(),r.validate(e).success(function(){return l.isClickedSave=!0,$(i).popover("hide")})},remove:function(o){o.preventDefault(),t.removeFormObject(e.$parent.formName,e.$parent.$index),$(i).popover("hide")},shown:function(){return e.data.backup(),l.isClickedSave=!1},cancel:function(t){e.data.rollback(),t&&(t.preventDefault(),$(i).popover("hide"))}},$(i).on("show.bs.popover",function(){var e,t,o;return n.isMouseMoved()?!1:($("div.fb-form-object-editable:not(."+l.id+")").popover("hide"),e=$("form."+l.id).closest(".popover"),e.length>0?(t=$(i).offset().top+$(i).height()/2,o=t-e.height()/2,e.css({position:"absolute",top:o}),e.show(),setTimeout(function(){return e.addClass("in"),$(i).triggerHandler("shown.bs.popover")},0),!1):void 0)}),$(i).on("shown.bs.popover",function(){$(".popover ."+l.id+" input:first").select(),e.$apply(function(){return e.popover.shown()})}),$(i).on("hide.bs.popover",function(){var t;return t=$("form."+l.id).closest(".popover"),l.isClickedSave||(e.$$phase||e.$root.$$phase?e.popover.cancel():e.$apply(function(){return e.popover.cancel()})),t.removeClass("in"),setTimeout(function(){return t.hide()},300),!1})):void 0}}}]).directive("fbComponents",function(){return{restrict:"A",template:'<ul ng-if="groups.length > 1" class="nav nav-tabs nav-justified">\n    <li ng-repeat="group in groups" ng-class="{active:activeGroup==group}">\n        <a href=\'#\' ng-click="selectGroup($event, group)">{{group}}</a>\n    </li>\n</ul>\n<div class=\'form-horizontal\'>\n    <div class=\'fb-component\' ng-repeat="component in components"\n        fb-component="component"></div>\n</div>',controller:"fbComponentsController"}}).directive("fbComponent",["$injector",function(e){var t,o,n;return t=e.get("$builder"),n=e.get("$drag"),o=e.get("$compile"),{restrict:"A",scope:{component:"=fbComponent"},controller:"fbComponentController",link:function(e,t){return e.copyObjectToScope(e.component),n.draggable($(t),{mode:"mirror",defer:!1,object:{componentName:e.component.name}}),e.$watch("component.template",function(n){var r;if(n)return r=o(n)(e),$(t).html(r)})}}}]).directive("fbForm",["$injector",function(e){return{restrict:"A",require:"ngModel",scope:{formName:"@fbForm",input:"=ngModel","default":"=fbDefault"},template:'<div class=\'fb-form-object\' ng-repeat="object in form" fb-form-object="object"></div>',controller:"fbFormController",link:function(t,o,n){var r,i,l;return r=e.get("$builder"),null==(i=r.forms)[l=t.formName]&&(i[l]=[]),t.form=r.forms[t.formName]}}}]).directive("fbFormObject",["$injector",function(e){var t,o,n;return t=e.get("$builder"),o=e.get("$compile"),n=e.get("$parse"),{restrict:"A",controller:"fbFormObjectController",link:function(e,r,i){return e.formObject=n(i.fbFormObject)(e),e.$component=t.components[e.formObject.component],e.$on(t.broadcastChannel.updateInput,function(){return e.updateInput(e.inputText)}),e.$component.arrayToText&&(e.inputArray=[],e.$watch("inputArray",function(t,o){var n,r;if(t!==o){n=[];for(r in e.inputArray)e.inputArray[r]&&n.push(e.options[r]);return e.inputText=n.join(", ")}},!0)),e.$watch("inputText",function(){return e.updateInput(e.inputText)}),e.$watch(i.fbFormObject,function(){return e.copyObjectToScope(e.formObject)},!0),e.$watch("$component.template",function(t){var n,i,l;if(t)return i=$(t),n=i.find("[ng-model='inputText']"),n.attr({validator:"{{validation}}"}),l=o(i)(e),$(r).html(l)}),!e.$component.arrayToText&&e.formObject.options.length>0&&(e.inputText=e.formObject.options[0]),e.$watch("default["+e.formObject.id+"]",function(t){return t?e.$component.arrayToText?e.inputArray=t:e.inputText=t:void 0})}}}])}.call(this),function(){angular.module("builder.drag",[]).provider("$drag",function(){var e,t,o;e=null,t=null,this.data={draggables:{},droppables:{}},this.mouseMoved=!1,this.isMouseMoved=function(e){return function(){return e.mouseMoved}}(this),this.hooks={down:{},move:{},up:{}},this.eventMouseMove=function(){},this.eventMouseUp=function(){},$(function(e){return function(){return $(document).on("mousedown",function(t){var o,n,r;e.mouseMoved=!1,r=e.hooks.down;for(n in r)(o=r[n])(t)}),$(document).on("mousemove",function(t){var o,n,r;e.mouseMoved=!0,r=e.hooks.move;for(n in r)(o=r[n])(t)}),$(document).on("mouseup",function(t){var o,n,r;r=e.hooks.up;for(n in r)(o=r[n])(t)})}}(this)),this.currentId=0,this.getNewId=function(e){return function(){return""+e.currentId++}}(this),this.setupEasing=function(){return jQuery.extend(jQuery.easing,{easeOutQuad:function(e,t,o,n,r){return-n*(t/=r)*(t-2)+o}})},this.setupProviders=function(o){return e=o,t=e.get("$rootScope")},this.isHover=function(e){return function(e,t){var o,n,r,i,l;return n=e.offset(),r=t.offset(),i={width:e.width(),height:e.height()},l={width:t.width(),height:t.height()},o={x:!1,y:!1},o.x=n.left>r.left&&n.left<r.left+l.width,o.x=o.x||n.left+i.width>r.left&&n.left+i.width<r.left+l.width,o?(o.y=n.top>r.top&&n.top<r.top+l.height,o.y=o.y||n.top+i.height>r.top&&n.top+i.height<r.top+l.height,o.x&&o.y):!1}}(this),o=function(e,t){return setTimeout(function(){return t()},e)},this.autoScroll={up:!1,down:!1,scrolling:!1,scroll:function(e){return function(){return e.autoScroll.scrolling=!0,e.autoScroll.up?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()-50},100,"easeOutQuad"),o(100,function(){return e.autoScroll.scroll()})):e.autoScroll.down?($("html, body").dequeue().animate({scrollTop:$(window).scrollTop()+50},100,"easeOutQuad"),o(100,function(){return e.autoScroll.scroll()})):e.autoScroll.scrolling=!1}}(this),start:function(e){return function(t){if(t.clientY<50){if(e.autoScroll.up=!0,e.autoScroll.down=!1,!e.autoScroll.scrolling)return e.autoScroll.scroll()}else{if(!(t.clientY>$(window).innerHeight()-50))return e.autoScroll.up=!1,e.autoScroll.down=!1;if(e.autoScroll.up=!1,e.autoScroll.down=!0,!e.autoScroll.scrolling)return e.autoScroll.scroll()}}}(this),stop:function(e){return function(){return e.autoScroll.up=!1,e.autoScroll.down=!1}}(this)},this.dragMirrorMode=function(e){return function(t,o,n){var r;return null==o&&(o=!0),r={id:e.getNewId(),mode:"mirror",maternal:t[0],element:null,object:n},t.on("mousedown",function(n){var i;return n.preventDefault(),i=t.clone(),r.element=i[0],i.addClass("fb-draggable form-horizontal prepare-dragging"),e.hooks.move.drag=function(o,n){var l,u,a,c;if(!i.hasClass("prepare-dragging")||(i.css({width:t.width(),height:t.height()}),i.removeClass("prepare-dragging"),i.addClass("dragging"),!n)){i.offset({left:o.pageX-i.width()/2,top:o.pageY-i.height()/2}),e.autoScroll.start(o),a=e.data.droppables,c=[];for(u in a)l=a[u],e.isHover(i,$(l.element))?c.push(l.move(o,r)):c.push(l.out(o,r));return c}},e.hooks.up.drag=function(t){var o,n,l,u;u=e.data.droppables;for(n in u)o=u[n],l=e.isHover(i,$(o.element)),o.up(t,l,r);return delete e.hooks.move.drag,delete e.hooks.up.drag,r.element=null,i.remove(),e.autoScroll.stop()},$("body").append(i),o?void 0:e.hooks.move.drag(n,o)}),r}}(this),this.dragDragMode=function(e){return function(t,o,n){var r;return null==o&&(o=!0),r={id:e.getNewId(),mode:"drag",maternal:null,element:t[0],object:n},t.addClass("fb-draggable"),t.on("mousedown",function(n){return n.preventDefault(),t.hasClass("dragging")?void 0:(t.addClass("prepare-dragging"),e.hooks.move.drag=function(o,n){var i,l,u;if(!t.hasClass("prepare-dragging")||(t.css({width:t.width(),height:t.height()}),t.removeClass("prepare-dragging"),t.addClass("dragging"),!n)){t.offset({left:o.pageX-t.width()/2,top:o.pageY-t.height()/2}),e.autoScroll.start(o),u=e.data.droppables;for(l in u)i=u[l],e.isHover(t,$(i.element))?i.move(o,r):i.out(o,r)}},e.hooks.up.drag=function(o){var n,i,l,u;u=e.data.droppables;for(i in u)n=u[i],l=e.isHover(t,$(n.element)),n.up(o,l,r);return delete e.hooks.move.drag,delete e.hooks.up.drag,t.css({width:"",height:"",left:"",top:""}),t.removeClass("dragging defer-dragging"),e.autoScroll.stop()},o?void 0:e.hooks.move.drag(n,o))}),r}}(this),this.dropMode=function(e){return function(o,n){var r;return r={id:e.getNewId(),element:o[0],move:function(e,o){return t.$apply(function(){return"function"==typeof n.move?n.move(e,o):void 0})},up:function(e,o,r){return t.$apply(function(){return"function"==typeof n.up?n.up(e,o,r):void 0})},out:function(e,o){return t.$apply(function(){return"function"==typeof n.out?n.out(e,o):void 0})}}}}(this),this.draggable=function(e){return function(t,o){var n,r,i,l,u,a,c;if(null==o&&(o={}),i=[],"mirror"===o.mode)for(l=0,a=t.length;a>l;l++)r=t[l],n=e.dragMirrorMode($(r),o.defer,o.object),i.push(n.id),e.data.draggables[n.id]=n;else for(u=0,c=t.length;c>u;u++)r=t[u],n=e.dragDragMode($(r),o.defer,o.object),i.push(n.id),e.data.draggables[n.id]=n;return i}}(this),this.droppable=function(e){return function(t,o){var n,r,i,l,u;for(null==o&&(o={}),i=[],l=0,u=t.length;u>l;l++)r=t[l],n=e.dropMode($(r),o),i.push(n),e.data.droppables[n.id]=n;return i}}(this),this.get=function(e){return this.setupEasing(),this.setupProviders(e),{isMouseMoved:this.isMouseMoved,data:this.data,draggable:this.draggable,droppable:this.droppable}},this.get.$inject=["$injector"],this.$get=this.get})}.call(this),function(){angular.module("builder",["builder.directive"])}.call(this),function(){var e=[].indexOf||function(e){for(var t=0,o=this.length;o>t;t++)if(t in this&&this[t]===e)return t;return-1};angular.module("builder.provider",[]).provider("$builder",function(){var t,o,n;o=null,t=null,n=null,this.version="0.0.2",this.components={},this.groups=[],this.broadcastChannel={updateInput:"$updateInput"},this.forms={"default":[]},this.formsId={"default":0},this.convertComponent=function(e,t){var o,n,r,i,l,u,a,c,p,d,s;return o={name:e,group:null!=(n=t.group)?n:"Default",label:null!=(r=t.label)?r:"",description:null!=(i=t.description)?i:"",placeholder:null!=(l=t.placeholder)?l:"",editable:null!=(u=t.editable)?u:!0,required:null!=(a=t.required)?a:!1,validation:null!=(c=t.validation)?c:"/.*/",validationOptions:null!=(p=t.validationOptions)?p:[],options:null!=(d=t.options)?d:[],arrayToText:null!=(s=t.arrayToText)?s:!1,template:t.template,templateUrl:t.templateUrl,popoverTemplate:t.popoverTemplate,popoverTemplateUrl:t.popoverTemplateUrl},o.template||o.templateUrl||console.error("The template is empty."),o.popoverTemplate||o.popoverTemplateUrl||console.error("The popoverTemplate is empty."),o},this.convertFormObject=function(e,t){var o,n,r,i,l,u,a,c,p,d,s,f,m,h,v,b,g;if(null==t&&(t={}),o=this.components[t.component],null==o)throw"The component "+t.component+" was not registered.";if(t.id){for(n=!1,a=this.forms[e],l=0,u=a.length;u>l;l++)if(r=a[l],t.id<=r.id){t.id=this.formsId[e]++,n=!0;break}n||(this.formsId[e]=t.id+1)}return i={id:null!=(c=t.id)?c:this.formsId[e]++,component:t.component,editable:null!=(p=t.editable)?p:o.editable,index:null!=(d=t.index)?d:0,label:null!=(s=t.label)?s:o.label,description:null!=(f=t.description)?f:o.description,placeholder:null!=(m=t.placeholder)?m:o.placeholder,options:null!=(h=t.options)?h:o.options,required:null!=(v=t.required)?v:o.required,validation:null!=(b=t.validation)?b:o.validation,name:null!=(g=t.name)?g:o.name}},this.reindexFormObject=function(e){return function(t){var o,n,r,i;for(o=e.forms[t],n=r=0,i=o.length;i>r;n=r+=1)o[n].index=n}}(this),this.setupProviders=function(e){return function(e){return o=e,t=o.get("$http"),n=o.get("$templateCache")}}(this),this.loadTemplate=function(e){return null==e.template&&t.get(e.templateUrl,{cache:n}).success(function(t){return e.template=t}),null==e.popoverTemplate?t.get(e.popoverTemplateUrl,{cache:n}).success(function(t){return e.popoverTemplate=t}):void 0},this.registerComponent=function(t){return function(n,r){var i,l;null==r&&(r={}),null==t.components[n]?(i=t.convertComponent(n,r),t.components[n]=i,null!=o&&t.loadTemplate(i),l=i.group,e.call(t.groups,l)<0&&t.groups.push(i.group)):console.error("The component "+n+" was registered.")}}(this),this.addFormObject=function(e){return function(t,o){var n;return null==o&&(o={}),null==(n=e.forms)[t]&&(n[t]=[]),e.insertFormObject(t,e.forms[t].length,o)}}(this),this.insertFormObject=function(e){return function(t,o,n){var r,i;return null==n&&(n={}),null==(r=e.forms)[t]&&(r[t]=[]),null==(i=e.formsId)[t]&&(i[t]=0),o>e.forms[t].length?o=e.forms[t].length:0>o&&(o=0),e.forms[t].splice(o,0,e.convertFormObject(t,n)),e.reindexFormObject(t),e.forms[t][o]}}(this),this.removeFormObject=function(e){return function(t,o){var n;return n=e.forms[t],n.splice(o,1),e.reindexFormObject(t)}}(this),this.updateFormObjectIndex=function(e){return function(t,o,n){var r,i;if(o!==n)return i=e.forms[t],r=i.splice(o,1)[0],i.splice(n,0,r),e.reindexFormObject(t)}}(this),this.$get=["$injector",function(e){return function(t){var o,n,r;e.setupProviders(t),r=e.components;for(n in r)o=r[n],e.loadTemplate(o);return{version:e.version,components:e.components,groups:e.groups,forms:e.forms,broadcastChannel:e.broadcastChannel,registerComponent:e.registerComponent,addFormObject:e.addFormObject,insertFormObject:e.insertFormObject,removeFormObject:e.removeFormObject,updateFormObjectIndex:e.updateFormObjectIndex}}}(this)]})}.call(this);
//# sourceMappingURL=form-builder.min.js.map
