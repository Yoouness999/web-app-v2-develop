(function(){var r;r=angular.element,angular.module("validator.directive",["validator.provider"]).directive("validator",["$injector",function(e){return{restrict:"A",require:"ngModel",link:function(t,n,o,i){var a,s,u,c,l,d,f,v,h,p;return s=e.get("$validator"),a=e.get("$parse"),c=a(o.ngModel),h=[],p=function(r,a){var s,u,l,d,f,v,p;if(null==a&&(a={}),d=0,s=0,u=function(){var r,s,u;if(++d>=h.length){for(i.$setValidity(o.ngModel,!0),s=0,u=h.length;u>s;s++)r=h[s],r.success(c(t),t,n,o,e);"function"==typeof a.success&&a.success()}},0===h.length)return u();for(f=function(r){return r.validator(c(t),t,n,o,{success:function(){return u()},error:function(){if(r.enableError&&1===++s&&(i.$setValidity(o.ngModel,!1),r.error(c(t),t,n,o,e)),1===("function"==typeof a.error?a.error():void 0)){try{n[0].scrollIntoViewIfNeeded()}catch(u){}return n[0].select()}}})},v=0,p=h.length;p>v;v++){switch(l=h[v],r){case"blur":if("blur"!==l.invoke)continue;l.enableError=!0;break;case"watch":if("watch"!==l.invoke&&!l.enableError){u();continue}break;case"broadcast":l.enableError=!0}f(l)}},f=function(){var r;return r=s.getRule("required"),null==r&&(r=s.convertRule("required",{validator:/^.+$/,invoke:"watch"})),h.push(r)},v=function(r){var i,a,s,u,l;for(l=[],i=a=0,s=h.length;s>a;i=a+=1)(null!=(u=h[i])?u.name:void 0)===r&&(h[i].success(c(t),t,n,o,e),h.splice(i,1),l.push(i--));return l},o.$observe("validator",function(r){var i,a,u,c,d,v,p;if(h.length=0,(l.validatorRequired||l.required)&&f(),i=r.match(/^\/(.*)\/$/))return u=s.convertRule("dynamic",{validator:RegExp(i[1]),invoke:o.validatorInvoke,error:o.validatorError}),void h.push(u);if(i=r.match(/^\[(.+)\]$/)){for(c=i[1].split(","),p=[],d=0,v=c.length;v>d;d++)a=c[d],u=s.getRule(a.replace(/^\s+|\s+$/g,"")),"function"==typeof u.init&&u.init(t,n,o,e),u?p.push(h.push(u)):p.push(void 0);return p}}),o.$observe("validatorError",function(r){var e,t;return e=o.validator.match(/^\/(.*)\/$/),e?(v("dynamic"),t=s.convertRule("dynamic",{validator:RegExp(e[1]),invoke:o.validatorInvoke,error:r}),h.push(t)):void 0}),l={validatorRequired:!1,required:!1},o.$observe("validatorRequired",function(r){return r&&"false"!==r?(f(),l.validatorRequired=!0):l.validatorRequired?(v("required"),l.validatorRequired=!1):void 0}),o.$observe("required",function(r){return r&&"false"!==r?(f(),l.required=!0):l.required?(v("required"),l.required=!1):void 0}),u=function(r,e){var n,i,s,u;return e?o.validatorGroup===e?!0:r.targetScope===t?0===o.ngModel.indexOf(e):(n=function(r,e){var t,o;for(t in r)switch(o=r[t],typeof o){case"string":if("$$hashKey"===t&&o===e)return!0;break;case"object":if(n(o,e))return!0}return!1},i=o.ngModel.indexOf("."),s=i>=0?o.ngModel.substr(0,i):o.ngModel,u=a(s)(t),n(a(e)(r.targetScope),u.$$hashKey)):!0},t.$on(s.broadcastChannel.prepare,function(r,e){return u(r,e.model)?e.accept():void 0}),t.$on(s.broadcastChannel.start,function(r,e){return u(r,e.model)?p("broadcast",{success:e.success,error:e.error}):void 0}),t.$on(s.broadcastChannel.reset,function(r,a){var s,l,d;if(u(r,a.model)){for(l=0,d=h.length;d>l;l++)s=h[l],s.success(c(t),t,n,o,e),"watch"!==s.invoke&&(s.enableError=!1);return i.$setValidity(o.ngModel,!0)}}),t.$watch(o.ngModel,function(r,e){return r!==e?p("watch",{oldValue:e}):void 0}),d=function(){return t.$root.$$phase?p("blur"):t.$apply(function(){return p("blur")})},r(n).bind("blur",d),t.$on("$destroy",function(){return r(n).unbind("blur",d)})}}}])}).call(this),function(){angular.module("validator",["validator.directive"])}.call(this),function(){var r;r=angular.element,angular.module("validator.provider",[]).provider("$validator",function(){var e,t,n;e=null,t=null,n=null,this.rules={},this.broadcastChannel={prepare:"$validatePrepare",start:"$validateStart",reset:"$validateReset"},this.setupProviders=function(r){return e=r,t=e.get("$q"),n=e.get("$timeout")},this.convertError=function(e){var t;return"function"==typeof e?e:(t=e.constructor===String?e:"",function(e,n,o,i){var a,s,u,c,l,d,f;for(u=r(o).parent(),f=[];0!==u.length;){if(u.hasClass("form-group")){for(u.addClass("has-error"),d=u.find("label"),c=0,l=d.length;l>c;c++)s=d[c],r(s).hasClass("error")&&r(s).remove();a=r("<label class='control-label error'>"+t+"</label>"),i.id&&a.attr("for",i.id),r(o).parent().hasClass("input-group")?r(o).parent().parent().append(a):r(o).parent().append(a);break}f.push(u=u.parent())}return f})},this.convertSuccess=function(e){return"function"==typeof e?e:function(e,t,n){var o,i,a,s,u,c;for(i=r(n).parent(),c=[];0!==i.length;){if(i.hasClass("has-error")){for(i.removeClass("has-error"),u=i.find("label"),a=0,s=u.length;s>a;a++)o=u[a],r(o).hasClass("error")&&r(o).remove();break}c.push(i=i.parent())}return c}},this.convertValidator=function(r){var n,o,i;return i=function(){},r.constructor===RegExp?(o=r,i=function(r,e,t,n,i){return null==r&&(r=""),o.test(r)?"function"==typeof i.success?i.success():void 0:"function"==typeof i.error?i.error():void 0}):"function"==typeof r&&(n=r,i=function(r,o,i,a,s){return t.all([n(r,o,i,a,e)]).then(function(r){return r&&r.length>0&&r[0]?"function"==typeof s.success?s.success():void 0:"function"==typeof s.error?s.error():void 0},function(){return"function"==typeof s.error?s.error():void 0})}),i},this.convertRule=function(r){return function(e,t){var n,o,i;return null==t&&(t={}),n={name:e,enableError:"watch"===t.invoke,invoke:t.invoke,init:t.init,validator:null!=(o=t.validator)?o:function(){return!0},error:null!=(i=t.error)?i:"",success:t.success},n.error=r.convertError(n.error),n.success=r.convertSuccess(n.success),n.validator=r.convertValidator(n.validator),n}}(this),this.register=function(r,e){return null==e&&(e={}),this.rules[r]=this.convertRule(r,e)},this.getRule=function(r){return this.rules[r]?angular.copy(this.rules[r]):null},this.validate=function(r){return function(o,i){var a,s,u,c,l;return u=t.defer(),l=u.promise,s={total:0,success:0,error:0},c={promises:{success:[],error:[],then:[]},accept:function(){return s.total++},validatedSuccess:function(){var r,e,t,n,o,i,a;if(++s.success===s.total){for(i=c.promises.success,e=0,n=i.length;n>e;e++)(r=i[e])();for(a=c.promises.then,t=0,o=a.length;o>t;t++)(r=a[t])()}return s.success},validatedError:function(){var r,e,t,n,o,i,a;if(0===s.error++){for(i=c.promises.error,e=0,n=i.length;n>e;e++)(r=i[e])();for(a=c.promises.then,t=0,o=a.length;o>t;t++)(r=a[t])()}return s.error}},l.success=function(r){return c.promises.success.push(r),l},l.error=function(r){return c.promises.error.push(r),l},l.then=function(r){return c.promises.then.push(r),l},a={model:i,accept:c.accept,success:c.validatedSuccess,error:c.validatedError},o.$broadcast(r.broadcastChannel.prepare,a),n(function(){var r,t,n,i,u;{if(0!==s.total)return r=e.get("$validator"),o.$broadcast(r.broadcastChannel.start,a);for(u=c.promises.success,n=0,i=u.length;i>n;n++)(t=u[n])()}}),l}}(this),this.reset=function(r){return function(e,t){return e.$broadcast(r.broadcastChannel.reset,{model:t})}}(this),this.get=function(r){return this.setupProviders(r),{rules:this.rules,broadcastChannel:this.broadcastChannel,register:this.register,convertRule:this.convertRule,getRule:this.getRule,validate:this.validate,reset:this.reset}},this.get.$inject=["$injector"],this.$get=this.get})}.call(this);
//# sourceMappingURL=form-validator.min.js.map
